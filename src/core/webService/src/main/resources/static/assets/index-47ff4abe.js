var Se=Object.defineProperty;var Ne=(t,e,n)=>e in t?Se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ee=(t,e,n)=>(Ne(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function w(){}function ye(t){return t()}function fe(){return Object.create(null)}function W(t){t.forEach(ye)}function we(t){return typeof t=="function"}function I(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Pe(t){return Object.keys(t).length===0}function p(t,e){t.appendChild(e)}function y(t,e,n){t.insertBefore(e,n||null)}function $(t){t.parentNode&&t.parentNode.removeChild(t)}function Ae(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function _(t){return document.createElement(t)}function A(t){return document.createTextNode(t)}function C(){return A(" ")}function Z(){return A("")}function le(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function ie(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function De(t){return Array.from(t.childNodes)}function J(t,e){e=""+e,t.data!==e&&(t.data=e)}function Me(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let K;function G(t){K=t}function ke(){if(!K)throw new Error("Function called outside component initialization");return K}function se(t){ke().$$.on_mount.push(t)}function ue(){const t=ke();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const i=Me(e,n,{cancelable:r});return o.slice().forEach(l=>{l.call(t,i)}),!i.defaultPrevented}return!0}}function ae(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const z=[],Q=[];let F=[];const ne=[],Te=Promise.resolve();let re=!1;function Be(){re||(re=!0,Te.then(Ce))}function oe(t){F.push(t)}function ve(t){ne.push(t)}const te=new Set;let H=0;function Ce(){if(H!==0)return;const t=K;do{try{for(;H<z.length;){const e=z[H];H++,G(e),Ue(e.$$)}}catch(e){throw z.length=0,H=0,e}for(G(null),z.length=0,H=0;Q.length;)Q.pop()();for(let e=0;e<F.length;e+=1){const n=F[e];te.has(n)||(te.add(n),n())}F.length=0}while(z.length);for(;ne.length;)ne.pop()();re=!1,te.clear(),G(t)}function Ue(t){if(t.fragment!==null){t.update(),W(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(oe)}}function Ie(t){const e=[],n=[];F.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),F=e}const Y=new Set;let B;function Le(){B={r:0,c:[],p:B}}function Ee(){B.r||W(B.c),B=B.p}function L(t,e){t&&t.i&&(Y.delete(t),t.i(e))}function E(t,e,n,r){if(t&&t.o){if(Y.has(t))return;Y.add(t),B.c.push(()=>{Y.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function X(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function je(t,e){t.d(1),e.delete(t.key)}function Re(t,e,n,r,o,i,l,s,c,u,f,a){let m=t.length,h=i.length,d=m;const g={};for(;d--;)g[t[d].key]=d;const P=[],O=new Map,b=new Map,D=[];for(d=h;d--;){const k=a(o,i,d),S=n(k);let N=l.get(S);N?r&&D.push(()=>N.p(k,e)):(N=u(S,k),N.c()),O.set(S,P[d]=N),S in g&&b.set(S,Math.abs(d-g[S]))}const q=new Set,ce=new Set;function x(k){L(k,1),k.m(s,f),l.set(k.key,k),f=k.first,h--}for(;m&&h;){const k=P[h-1],S=t[m-1],N=k.key,V=S.key;k===S?(f=k.first,m--,h--):O.has(V)?!l.has(N)||q.has(N)?x(k):ce.has(V)?m--:b.get(N)>b.get(V)?(ce.add(N),x(k)):(q.add(V),m--):(c(S,l),m--)}for(;m--;){const k=t[m];O.has(k.key)||c(k,l)}for(;h;)x(P[h-1]);return W(D),P}function Oe(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function U(t){t&&t.c()}function M(t,e,n){const{fragment:r,after_update:o}=t.$$;r&&r.m(e,n),oe(()=>{const i=t.$$.on_mount.map(ye).filter(we);t.$$.on_destroy?t.$$.on_destroy.push(...i):W(i),t.$$.on_mount=[]}),o.forEach(oe)}function T(t,e){const n=t.$$;n.fragment!==null&&(Ie(n.after_update),W(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function He(t,e){t.$$.dirty[0]===-1&&(z.push(t),Be(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function j(t,e,n,r,o,i,l=null,s=[-1]){const c=K;G(t);const u=t.$$={fragment:null,ctx:[],props:i,update:w,not_equal:o,bound:fe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:fe(),dirty:s,skip_bound:!1,root:e.target||c.$$.root};l&&l(u.root);let f=!1;if(u.ctx=n?n(t,e.props||{},(a,m,...h)=>{const d=h.length?h[0]:m;return u.ctx&&o(u.ctx[a],u.ctx[a]=d)&&(!u.skip_bound&&u.bound[a]&&u.bound[a](d),f&&He(t,a)),m}):[],u.update(),f=!0,W(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){const a=De(e.target);u.fragment&&u.fragment.l(a),a.forEach($)}else u.fragment&&u.fragment.c();e.intro&&L(t.$$.fragment),M(t,e.target,e.anchor),Ce()}G(c)}class R{constructor(){ee(this,"$$");ee(this,"$$set")}$destroy(){T(this,1),this.$destroy=w}$on(e,n){if(!we(n))return w;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(e){this.$$set&&!Pe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ze="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ze);function de(t,e,n){const r=t.slice();return r[2]=e[n],r}function he(t){let e,n,r=t[2]+"",o,i,l,s=t[0][t[2]]+"",c,u;return{c(){e=_("tr"),n=_("td"),o=A(r),i=C(),l=_("td"),c=A(s),u=C()},m(f,a){y(f,e,a),p(e,n),p(n,o),p(e,i),p(e,l),p(l,c),p(e,u)},p(f,a){a&1&&r!==(r=f[2]+"")&&J(o,r),a&1&&s!==(s=f[0][f[2]]+"")&&J(c,s)},d(f){f&&$(e)}}}function Fe(t){let e,n,r,o,i=X(Object.keys(t[0])),l=[];for(let s=0;s<i.length;s+=1)l[s]=he(de(t,i,s));return{c(){e=_("table"),n=_("thead"),n.innerHTML="<tr><th>Asset</th> <th>Balance</th></tr>",r=C(),o=_("tbody");for(let s=0;s<l.length;s+=1)l[s].c()},m(s,c){y(s,e,c),p(e,n),p(e,r),p(e,o);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(o,null)},p(s,[c]){if(c&1){i=X(Object.keys(s[0]));let u;for(u=0;u<i.length;u+=1){const f=de(s,i,u);l[u]?l[u].p(f,c):(l[u]=he(f),l[u].c(),l[u].m(o,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=i.length}},i:w,o:w,d(s){s&&$(e),Ae(l,s)}}}function We(t,e,n){let r={};function o(){fetch("balances/list").then(i=>i.json()).then(i=>n(0,r=i))}return se(()=>{o()}),[r,o]}class qe extends R{constructor(e){super(),j(this,e,We,Fe,I,{refresh:1})}get refresh(){return this.$$.ctx[1]}}function me(t){let e,n=t[0].name+"",r,o,i;return{c(){e=A("Hello, "),r=A(n),o=A(". "),i=_("a"),i.textContent="Logout",v(i,"href","/logout")},m(l,s){y(l,e,s),y(l,r,s),y(l,o,s),y(l,i,s)},p(l,s){s&1&&n!==(n=l[0].name+"")&&J(r,n)},d(l){l&&($(e),$(r),$(o),$(i))}}}function Ge(t){let e,n=t[0]!=null&&me(t);return{c(){n&&n.c(),e=Z()},m(r,o){n&&n.m(r,o),y(r,e,o)},p(r,[o]){r[0]!=null?n?n.p(r,o):(n=me(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:w,o:w,d(r){r&&$(e),n&&n.d(r)}}}async function Je(){try{const t=await fetch("system/whoami");if(!t.ok)throw new Error(`Error! status: ${t.status}`);return await t.json()}catch(t){return t instanceof Error?(console.log("error message: ",t.message),null):(console.log("unexpected error: ",t),null)}}function Ke(t,e,n){let{user:r=null}=e;return se(async()=>{n(0,r=await Je())}),t.$$set=o=>{"user"in o&&n(0,r=o.user)},[r]}class Ve extends R{constructor(e){super(),j(this,e,Ke,Ge,I,{user:0})}}function Ye(t){let e,n,r;return{c(){e=_("form"),e.innerHTML='<label>Asset<input type="text" name="assetCode" placeholder="USD"/></label> <label>Amount<input type="text" name="amount" placeholder="100"/></label> <input type="submit" value="Deposit"/>',v(e,"method","post"),v(e,"action","/balances/deposit")},m(o,i){y(o,e,i),n||(r=le(e,"submit",ie(t[0])),n=!0)},p:w,i:w,o:w,d(o){o&&$(e),n=!1,r()}}}function Qe(t){const e=ue();return[r=>{const o=r.target.action,i=new FormData(r.target),l=new URLSearchParams;for(let s of i){const[c,u]=s;l.append(c,u)}fetch(o,{method:"POST",body:l}).then(s=>{r.target.reset(),e("deposit",{})})}]}class Xe extends R{constructor(e){super(),j(this,e,Qe,Ye,I,{})}}function pe(t,e,n){const r=t.slice();return r[4]=e[n],r[6]=n,r}function Ze(t){let e=[],n=new Map,r,o=X(t[0]);const i=l=>l[0].indexOf(l[4]);for(let l=0;l<o.length;l+=1){let s=pe(t,o,l),c=i(s);n.set(c,e[l]=be(c,s))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();r=Z()},m(l,s){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,s);y(l,r,s)},p(l,s){s&7&&(o=X(l[0]),e=Re(e,s,i,1,l,o,n,r.parentNode,je,be,r,pe))},d(l){l&&$(r);for(let s=0;s<e.length;s+=1)e[s].d(l)}}}function xe(t){let e;return{c(){e=_("tr"),e.innerHTML='<td colspan="3">No entries.</td>'},m(n,r){y(n,e,r)},p:w,d(n){n&&$(e)}}}function _e(t){let e,n,r,o,i,l,s,c,u;return{c(){e=_("form"),n=_("input"),o=C(),i=_("input"),l=C(),s=_("input"),v(n,"type","hidden"),v(n,"name","id"),n.value=r=t[4].id,v(i,"type","hidden"),v(i,"name","instrumentCode"),i.value=t[1],v(s,"type","submit"),s.value="Cancel",v(e,"class","order-cancel"),v(e,"method","post"),v(e,"action","/orders/cancel")},m(f,a){y(f,e,a),p(e,n),p(e,o),p(e,i),p(e,l),p(e,s),c||(u=le(e,"submit",ie(t[2])),c=!0)},p(f,a){a&1&&r!==(r=f[4].id)&&(n.value=r),a&2&&(i.value=f[1])},d(f){f&&$(e),c=!1,u()}}}function be(t,e){let n,r,o=e[4].price+"",i,l,s,c=e[4].size+"",u,f,a,m,h=e[4].canCancel&&_e(e);return{key:t,first:null,c(){n=_("tr"),r=_("td"),i=A(o),l=C(),s=_("td"),u=A(c),f=C(),a=_("td"),h&&h.c(),m=C(),this.first=n},m(d,g){y(d,n,g),p(n,r),p(r,i),p(n,l),p(n,s),p(s,u),p(n,f),p(n,a),h&&h.m(a,null),p(n,m)},p(d,g){e=d,g&1&&o!==(o=e[4].price+"")&&J(i,o),g&1&&c!==(c=e[4].size+"")&&J(u,c),e[4].canCancel?h?h.p(e,g):(h=_e(e),h.c(),h.m(a,null)):h&&(h.d(1),h=null)},d(d){d&&$(n),h&&h.d()}}}function et(t){let e;function n(i,l){return i[0].length===0?xe:Ze}let r=n(t),o=r(t);return{c(){o.c(),e=Z()},m(i,l){o.m(i,l),y(i,e,l)},p(i,[l]){r===(r=n(i))&&o?o.p(i,l):(o.d(1),o=r(i),o&&(o.c(),o.m(e.parentNode,e)))},i:w,o:w,d(i){i&&$(e),o.d(i)}}}function tt(t,e,n){const r=ue();let{bookEntryList:o}=e,{instrumentCode:i}=e;const l=s=>{const c=s.target.action,u=new FormData(s.target),f=new URLSearchParams;for(let a of u){const[m,h]=a;f.append(m,h)}fetch(c,{method:"POST",body:f}).then(a=>{r("order-canceled")})};return t.$$set=s=>{"bookEntryList"in s&&n(0,o=s.bookEntryList),"instrumentCode"in s&&n(1,i=s.instrumentCode)},[o,i,l]}class $e extends R{constructor(e){super(),j(this,e,tt,et,I,{bookEntryList:0,instrumentCode:1})}}function ge(t){let e,n,r,o,i,l,s,c,u,f;return i=new $e({props:{instrumentCode:t[0],bookEntryList:t[2]}}),i.$on("order-canceled",t[3]),u=new $e({props:{instrumentCode:t[0],bookEntryList:t[1]}}),u.$on("order-canceled",t[4]),{c(){e=_("table"),n=_("thead"),n.innerHTML="<tr><th>Price</th> <th>Size</th> <th></th></tr>",r=C(),o=_("tbody"),U(i.$$.fragment),l=C(),s=_("tr"),s.innerHTML='<td colspan="3">Mid</td>',c=C(),U(u.$$.fragment)},m(a,m){y(a,e,m),p(e,n),p(e,r),p(e,o),M(i,o,null),p(o,l),p(o,s),p(o,c),M(u,o,null),f=!0},p(a,m){const h={};m&1&&(h.instrumentCode=a[0]),m&4&&(h.bookEntryList=a[2]),i.$set(h);const d={};m&1&&(d.instrumentCode=a[0]),m&2&&(d.bookEntryList=a[1]),u.$set(d)},i(a){f||(L(i.$$.fragment,a),L(u.$$.fragment,a),f=!0)},o(a){E(i.$$.fragment,a),E(u.$$.fragment,a),f=!1},d(a){a&&$(e),T(i),T(u)}}}function nt(t){let e,n,r=t[1]!=null&&t[2]!=null&&ge(t);return{c(){r&&r.c(),e=Z()},m(o,i){r&&r.m(o,i),y(o,e,i),n=!0},p(o,[i]){o[1]!=null&&o[2]!=null?r?(r.p(o,i),i&6&&L(r,1)):(r=ge(o),r.c(),L(r,1),r.m(e.parentNode,e)):r&&(Le(),E(r,1,1,()=>{r=null}),Ee())},i(o){n||(L(r),n=!0)},o(o){E(r),n=!1},d(o){o&&$(e),r&&r.d(o)}}}function rt(t,e,n){let r,o,{instrumentCode:i}=e;se(()=>{let c=new WebSocket("ws://localhost:8081/market/data?instrumentCode="+i,"protocolOne");c.onmessage=u=>{var f=JSON.parse(u.data);n(1,r=f.bids.reverse()),n(2,o=f.asks.reverse())}});function l(c){ae.call(this,t,c)}function s(c){ae.call(this,t,c)}return t.$$set=c=>{"instrumentCode"in c&&n(0,i=c.instrumentCode)},[i,r,o,l,s]}class ot extends R{constructor(e){super(),j(this,e,rt,nt,I,{instrumentCode:0})}}function lt(t){let e,n,r;return{c(){e=_("form"),e.innerHTML='<label>Instrument<input type="text" name="instrumentCode" placeholder="SPY"/></label> <label>Amount<input type="text" name="amount" placeholder="10"/></label> <label>Price<input type="text" name="price" placeholder="$100"/></label> <input type="submit" name="buy" value="Buy"/> <input type="submit" name="sell" value="Sell"/>',v(e,"method","post"),v(e,"action","/orders/submit")},m(o,i){y(o,e,i),n||(r=le(e,"submit",ie(t[0])),n=!0)},p:w,i:w,o:w,d(o){o&&$(e),n=!1,r()}}}function it(t){const e=ue();return[r=>{const o=r.target.action,i=new FormData(r.target),l=new URLSearchParams;for(let c of i){const[u,f]=c;l.append(u,f)}let s=r.submitter.name==="buy"?"Buy":"Sell";l.append("side",s),fetch(o,{method:"POST",body:l}).then(c=>{r.target.reset(),e("submit-order",{})})}]}class st extends R{constructor(e){super(),j(this,e,it,lt,I,{})}}function ut(t){let e;return{c(){e=_("a"),e.textContent="Login with Google",v(e,"href","/oauth2/authorization/google")},m(n,r){y(n,e,r)},p:w,i:w,o:w,d(n){n&&$(e)}}}function ct(t){let e,n,r,o,i,l,s,c,u,f,a,m,h,d,g;r=new ot({props:{instrumentCode:"BTC/USD"}}),r.$on("order-canceled",t[3]),l=new st({}),l.$on("submit-order",t[3]);function P(b){t[5](b)}let O={};return t[1]!==void 0&&(O.refresh=t[1]),f=new qe({props:O}),Q.push(()=>Oe(f,"refresh",P)),d=new Xe({}),d.$on("deposit",t[2]),{c(){e=_("div"),n=_("div"),U(r.$$.fragment),o=C(),i=_("div"),U(l.$$.fragment),s=C(),c=_("div"),u=_("div"),U(f.$$.fragment),m=C(),h=_("div"),U(d.$$.fragment),v(e,"class","row"),v(c,"class","row")},m(b,D){y(b,e,D),p(e,n),M(r,n,null),p(e,o),p(e,i),M(l,i,null),y(b,s,D),y(b,c,D),p(c,u),M(f,u,null),p(c,m),p(c,h),M(d,h,null),g=!0},p(b,D){const q={};!a&&D&2&&(a=!0,q.refresh=b[1],ve(()=>a=!1)),f.$set(q)},i(b){g||(L(r.$$.fragment,b),L(l.$$.fragment,b),L(f.$$.fragment,b),L(d.$$.fragment,b),g=!0)},o(b){E(r.$$.fragment,b),E(l.$$.fragment,b),E(f.$$.fragment,b),E(d.$$.fragment,b),g=!1},d(b){b&&($(e),$(s),$(c)),T(r),T(l),T(f),T(d)}}}function ft(t){let e,n,r,o,i,l,s,c;function u(d){t[4](d)}let f={};t[0]!==void 0&&(f.user=t[0]),r=new Ve({props:f}),Q.push(()=>Oe(r,"user",u));const a=[ct,ut],m=[];function h(d,g){return d[0]!=null?0:1}return l=h(t),s=m[l]=a[l](t),{c(){e=_("main"),n=_("header"),U(r.$$.fragment),i=C(),s.c()},m(d,g){y(d,e,g),p(e,n),M(r,n,null),p(e,i),m[l].m(e,null),c=!0},p(d,[g]){const P={};!o&&g&1&&(o=!0,P.user=d[0],ve(()=>o=!1)),r.$set(P);let O=l;l=h(d),l===O?m[l].p(d,g):(Le(),E(m[O],1,1,()=>{m[O]=null}),Ee(),s=m[l],s?s.p(d,g):(s=m[l]=a[l](d),s.c()),L(s,1),s.m(e,null))},i(d){c||(L(r.$$.fragment,d),L(s),c=!0)},o(d){E(r.$$.fragment,d),E(s),c=!1},d(d){d&&$(e),T(r),m[l].d()}}}function at(t,e,n){let r,o;function i(){o()}function l(){o()}function s(u){r=u,n(0,r)}function c(u){o=u,n(1,o)}return[r,o,i,l,s,c]}class dt extends R{constructor(e){super(),j(this,e,at,ft,I,{})}}new dt({target:document.getElementById("app")});
